package asm

import (
	"fmt"
	"testing"
)

func Test_SMMUL(t *testing.T) {
	tests := []struct {
		op1, op2, result int32
	}{
		{0, 0, 0},
		{-1, -1, 0},
		{2147483647, 2147483647, 1073741823},
		{-2147483648, -2147483648, 1073741824},
		{2147483647, -2147483648, -1073741824},
		{-1, -2147483648, 0},
		{2147483647, -1, -1},
		{0, -1, 0},
		{469847548, 523840645, 57305498},
		{1791404762, 2101435147, 876495831},
		{1947422184, 2003110913, 908249669},
		{695507622, 1881709799, 304715593},
		{583229588, 454387517, 61702971},
		{1673509682, 1582833795, 616742223},
		{1841295872, 1651915321, 708192787},
		{1932155006, 1601323487, 720379220},
		{87174700, 1651982581, 33530193},
		{890207882, 954408187, 197817965},
		{279576856, 1430779761, 93135262},
		{1332672854, 1354534359, 420294508},
		{516560580, 244554157, 29412805},
		{1987663074, 1917988979, 887623957},
		{1672731440, 2004689833, 780752792},
		{2128338222, 1083531471, 536935740},
		{-469847548, -523840645, 57305498},
		{-1791404762, -2101435147, 876495831},
		{-1947422184, -2003110913, 908249669},
		{-695507622, -1881709799, 304715593},
		{-583229588, -454387517, 61702971},
		{-1673509682, -1582833795, 616742223},
		{-1841295872, -1651915321, 708192787},
		{-1932155006, -1601323487, 720379220},
		{-87174700, -1651982581, 33530193},
		{-890207882, -954408187, 197817965},
		{-279576856, -1430779761, 93135262},
		{-1332672854, -1354534359, 420294508},
		{-516560580, -244554157, 29412805},
		{-1987663074, -1917988979, 887623957},
		{-1672731440, -2004689833, 780752792},
		{-2128338222, -1083531471, 536935740},
	}
	for _, v := range tests {
		r := SMMUL(v.op1, v.op2)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SMMULR(t *testing.T) {
	tests := []struct {
		op1, op2, result int32
	}{
		{0, 0, 0},
		{-1, -1, 0},
		{2147483647, 2147483647, 1073741823},
		{-2147483648, -2147483648, 1073741824},
		{2147483647, -2147483648, -1073741823},
		{-1, -2147483648, 1},
		{2147483647, -1, 0},
		{0, -1, 0},
		{469847548, 523840645, 57305499},
		{-469847548, -523840645, 57305499},
		{1791404762, 2101435147, 876495831},
		{-1791404762, -2101435147, 876495831},
		{1947422184, 2003110913, 908249670},
		{-1947422184, -2003110913, 908249670},
		{695507622, 1881709799, 304715593},
		{-695507622, -1881709799, 304715593},
		{583229588, 454387517, 61702971},
		{-583229588, -454387517, 61702971},
		{1673509682, 1582833795, 616742224},
		{-1673509682, -1582833795, 616742224},
		{1841295872, 1651915321, 708192787},
		{-1841295872, -1651915321, 708192787},
		{1932155006, 1601323487, 720379220},
		{-1932155006, -1601323487, 720379220},
		{87174700, 1651982581, 33530194},
		{-87174700, -1651982581, 33530194},
		{890207882, 954408187, 197817965},
		{-890207882, -954408187, 197817965},
		{279576856, 1430779761, 93135263},
	}
	for _, v := range tests {
		r := SMMULR(v.op1, v.op2)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SMMLA(t *testing.T) {
	tests := []struct {
		op1, op2, op3, result int32
	}{
		{0, 0, 469847548, 469847548},
		{-1, -1, 523840645, 523840645},
		{2147483647, 2147483647, 1791404762, -1429820711},
		{-2147483648, -2147483648, 2101435147, -1119790325},
		{2147483647, -2147483648, 1947422184, 873680360},
		{-1, -2147483648, 2003110913, 2003110913},
		{2147483647, -1, 695507622, 695507621},
		{0, -1, 1881709799, 1881709799},
		{583229588, 454387517, 1673509682, 1735212653},
		{1582833795, 1841295872, 1651915321, -1964475136},
		{1932155006, 1601323487, 87174700, 807553920},
		{1651982581, 890207882, 954408187, 1296810774},
		{279576856, 1430779761, 1332672854, 1425808116},
		{1354534359, 516560580, 244554157, 407465538},
		{1987663074, 1917988979, 1672731440, -1734611899},
		{2004689833, 2128338222, 1083531471, 2076940198},
		{1915976284, 1314607461, 1221369402, 1807813149},
		{1915828971, 1537990728, 640982753, 1327024576},
		{1339450374, 862362311, 1656928500, 1925869202},
		{1643857949, 1801763474, 1235754083, 1925361943},
		{751595616, 663308569, 202370526, 318445871},
		{0, 0, -469847548, -469847548},
		{-1, -1, -523840645, -523840645},
		{2147483647, 2147483647, -1791404762, -717662939},
		{-2147483648, -2147483648, -2101435147, -1027693323},
		{2147483647, -2147483648, -1947422184, 1273803288},
		{-1, -2147483648, -2003110913, -2003110913},
		{2147483647, -1, -695507622, -695507623},
		{0, -1, -1881709799, -1881709799},
		{-583229588, -454387517, -1673509682, -1611806711},
		{-1582833795, -1841295872, -1651915321, -973338482},
		{-1932155006, -1601323487, -87174700, 633204520},
		{-1651982581, -890207882, -954408187, -612005600},
		{-279576856, -1430779761, -1332672854, -1239537592},
		{-1354534359, -516560580, -244554157, -81642776},
		{-1987663074, -1917988979, -1672731440, -785107483},
		{-2004689833, -2128338222, -1083531471, -90122744},
		{-1915976284, -1314607461, -1221369402, -634925655},
		{-1915828971, -1537990728, -640982753, 45059070},
		{-1339450374, -862362311, -1656928500, -1387987798},
		{-1643857949, -1801763474, -1235754083, -546146223},
	}
	for _, v := range tests {
		r := SMMLA(v.op1, v.op2, v.op3)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SMMLAR(t *testing.T) {
	tests := []struct {
		op1, op2, op3, result int32
	}{
		{0, 0, 469847548, 469847548},
		{0, 0, -469847548, -469847548},
		{-1, -1, 523840645, 523840645},
		{-1, -1, -523840645, -523840645},
		{2147483647, 2147483647, 1791404762, -1429820711},
		{2147483647, 2147483647, -1791404762, -717662939},
		{-2147483648, -2147483648, 2101435147, -1119790325},
		{-2147483648, -2147483648, -2101435147, -1027693323},
		{2147483647, -2147483648, 1947422184, 873680361},
		{2147483647, -2147483648, -1947422184, 1273803289},
		{-1, -2147483648, 2003110913, 2003110914},
		{-1, -2147483648, -2003110913, -2003110912},
		{2147483647, -1, 695507622, 695507622},
		{2147483647, -1, -695507622, -695507622},
		{0, -1, 1881709799, 1881709799},
		{0, -1, -1881709799, -1881709799},
		{583229588, 454387517, 1673509682, 1735212653},
		{-583229588, -454387517, -1673509682, -1611806711},
		{583229588, 454387517, -1673509682, -1611806711},
		{1582833795, 1841295872, 1651915321, -1964475136},
		{-1582833795, -1841295872, -1651915321, -973338482},
		{1582833795, 1841295872, -1651915321, -973338482},
	}
	for _, v := range tests {
		r := SMMLAR(v.op1, v.op2, v.op3)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SMMLS(t *testing.T) {
	tests := []struct {
		op1, op2, op3, result int32
	}{
		{0, 0, 469847548, 469847548},
		{-1, -1, 523840645, 523840644},
		{2147483647, 2147483647, 1791404762, 717662938},
		{-2147483648, -2147483648, 2101435147, 1027693323},
		{2147483647, -2147483648, 1947422184, -1273803289},
		{-1, -2147483648, 2003110913, 2003110912},
		{2147483647, -1, 695507622, 695507622},
		{0, -1, 1881709799, 1881709799},
		{583229588, 454387517, 1673509682, 1611806710},
		{1582833795, 1841295872, 1651915321, 973338481},
		{1932155006, 1601323487, 87174700, -633204521},
		{1651982581, 890207882, 954408187, 612005599},
		{279576856, 1430779761, 1332672854, 1239537591},
		{1354534359, 516560580, 244554157, 81642775},
		{1987663074, 1917988979, 1672731440, 785107482},
		{2004689833, 2128338222, 1083531471, 90122743},
		{1915976284, 1314607461, 1221369402, 634925654},
		{1915828971, 1537990728, 640982753, -45059071},
		{1339450374, 862362311, 1656928500, 1387987797},
		{1643857949, 1801763474, 1235754083, 546146222},
		{751595616, 663308569, 202370526, 86295180},
		{0, 0, -469847548, -469847548},
		{-1, -1, -523840645, -523840646},
		{2147483647, 2147483647, -1791404762, 1429820710},
		{-2147483648, -2147483648, -2101435147, 1119790325},
		{2147483647, -2147483648, -1947422184, -873680361},
		{-1, -2147483648, -2003110913, -2003110914},
		{2147483647, -1, -695507622, -695507622},
		{0, -1, -1881709799, -1881709799},
		{-583229588, -454387517, -1673509682, -1735212654},
		{-1582833795, -1841295872, -1651915321, 1964475135},
		{-1932155006, -1601323487, -87174700, -807553921},
		{-1651982581, -890207882, -954408187, -1296810775},
		{-279576856, -1430779761, -1332672854, -1425808117},
		{-1354534359, -516560580, -244554157, -407465539},
		{-1987663074, -1917988979, -1672731440, 1734611898},
		{-2004689833, -2128338222, -1083531471, -2076940199},
		{-1915976284, -1314607461, -1221369402, -1807813150},
		{-1915828971, -1537990728, -640982753, -1327024577},
		{-1339450374, -862362311, -1656928500, -1925869203},
		{-1643857949, -1801763474, -1235754083, -1925361944},
	}
	for _, v := range tests {
		r := SMMLS(v.op1, v.op2, v.op3)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SMMLSR(t *testing.T) {
	tests := []struct {
		op1, op2, op3, result int32
	}{
		{0, 0, 469847548, 469847548},
		{0, 0, -469847548, -469847548},
		{-1, -1, 523840645, 523840645},
		{-1, -1, -523840645, -523840645},
		{2147483647, 2147483647, 1791404762, 717662939},
		{2147483647, 2147483647, -1791404762, 1429820711},
		{-2147483648, -2147483648, 2101435147, 1027693323},
		{-2147483648, -2147483648, -2101435147, 1119790325},
		{2147483647, -2147483648, 1947422184, -1273803288},
		{2147483647, -2147483648, -1947422184, -873680360},
		{-1, -2147483648, 2003110913, 2003110913},
		{-1, -2147483648, -2003110913, -2003110913},
		{2147483647, -1, 695507622, 695507622},
		{2147483647, -1, -695507622, -695507622},
		{0, -1, 1881709799, 1881709799},
		{0, -1, -1881709799, -1881709799},
		{583229588, 454387517, 1673509682, 1611806711},
		{-583229588, -454387517, -1673509682, -1735212653},
		{1582833795, 1841295872, 1651915321, 973338482},
		{-1582833795, -1841295872, -1651915321, 1964475136},
		{1932155006, 1601323487, 87174700, -633204520},
		{-1932155006, -1601323487, -87174700, -807553920},
	}
	for _, v := range tests {
		r := SMMLSR(v.op1, v.op2, v.op3)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SSAT(t *testing.T) {
	tests := []struct {
		op1    int32
		n      int
		result int32
	}{
		{1517528838, 1, 0},
		{1699307760, 2, 1},
		{1658676714, 3, 3},
		{163959924, 4, 7},
		{1492004622, 5, 15},
		{544209976, 6, 31},
		{850159218, 7, 63},
		{839834684, 8, 127},
		{-903827434, 9, -256},
		{-1495943040, 10, -512},
		{-1153830918, 11, -1024},
		{-253225724, 12, -2048},
		{1005668894, 13, 4095},
		{1528673736, 14, 8191},
		{1387143810, 15, 16383},
		{433868, 16, 32767},
		{250223910, 17, 65535},
		{758060048, 18, 131071},
		{-1475011062, 19, -262144},
		{-1230792300, 20, -524288},
		{649677102, 21, 1048575},
		{-21695656, 22, -2097152},
		{2078212754, 23, 4194303},
		{-1241766564, 24, -8388608},
		{716238390, 25, 16777215},
		{-1751223392, 26, -33554432},
		{-396365798, 27, -67108864},
		{634479140, 28, 134217727},
		{-699978690, 29, -268435456},
		{715044072, 30, 536870911},
		{978323106, 31, 978323106},
		{15233004, 32, 15233004},
		{-2147453434, 1, -1},
		{-2147463385, 2, -2},
		{7660, 3, 3},
		{-2147470296, 4, -8},
		{-2147470254, 5, -16},
		{-2147451411, 6, -32},
		{-2147471851, 7, -64},
		{23057, 8, 127},
		{31093, 9, 255},
		{11067, 10, 511},
		{3289, 11, 1023},
		{11327, 12, 2047},
		{-2147474106, 13, -4096},
		{10484, 14, 8191},
		{-2147454818, 15, -16384},
		{26835, 16, 26835},
		{8088, 17, 8088},
		{-2147473580, 18, -131072},
		{7043, 19, 7043},
		{-2147469816, 20, -524288},
		{-2147460166, 21, -1048576},
		{9335, 22, 9335},
		{5862, 23, 5862},
		{2487, 24, 2487},
		{19446, 25, 19446},
		{19409, 26, 19409},
		{24288, 27, 24288},
		{-2147483437, 28, -134217728},
		{17685, 29, 17685},
		{17845, 30, 17845},
		{32197, 31, 32197},
		{-2147473684, 32, -2147473684},
	}
	for _, v := range tests {
		r := SSAT(v.op1, v.n, 0)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_USAT(t *testing.T) {
	tests := []struct {
		op1    int32
		n      int
		result uint32
	}{
		{1841135875, 0, 0x00000000},
		{-405800011, 1, 0x00000000},
		{-1613274441, 2, 0x00000000},
		{-1038362999, 3, 0x00000000},
		{1824500651, 4, 0x0000000F},
		{-1683191139, 5, 0x00000000},
		{1377144799, 6, 0x0000003F},
		{-1474925583, 7, 0x00000000},
		{-633896109, 8, 0x00000000},
		{-505475451, 9, 0x00000000},
		{1224161799, 10, 0x000003FF},
		{676415065, 11, 0x000007FF},
		{-544364549, 12, 0x00000000},
		{1720788845, 13, 0x00001FFF},
		{1808728367, 14, 0x00003FFF},
		{-1745877567, 15, 0x00000000},
		{379500963, 16, 0x0000FFFF},
		{1031828821, 17, 0x0001FFFF},
		{-1516010153, 18, 0x00000000},
		{-1729476055, 19, 0x00000000},
		{607869003, 20, 0x000FFFFF},
		{-1065445315, 21, 0x00000000},
		{665806463, 22, 0x003FFFFF},
		{1619768209, 23, 0x007FFFFF},
		{581444595, 24, 0x00FFFFFF},
		{1039216677, 25, 0x01FFFFFF},
		{2078360743, 26, 0x03FFFFFF},
		{1307828729, 27, 0x07FFFFFF},
		{1545452699, 28, 0x0FFFFFFF},
		{-145629939, 29, 0x00000000},
		{-413417521, 30, 0x00000000},
		{-795445919, 31, 0x00000000},
		{-2147457562, 0, 0x00000000},
		{-2147459848, 1, 0x00000000},
		{-2147456016, 2, 0x00000000},
		{-2147460242, 3, 0x00000000},
		{-2147477417, 4, 0x00000000},
		{-2147477190, 5, 0x00000000},
		{-2147478476, 6, 0x00000000},
		{-2147481456, 7, 0x00000000},
		{7705, 8, 0x000000FF},
		{-2147460903, 9, 0x00000000},
		{19130, 10, 0x000003FF},
		{-2147453633, 11, 0x00000000},
		{-2147474344, 12, 0x00000000},
		{24567, 13, 0x00001FFF},
		{-2147461903, 14, 0x00000000},
		{30289, 15, 0x00007651},
		{18217, 16, 0x00004729},
		{-2147456639, 17, 0x00000000},
		{-2147456522, 18, 0x00000000},
		{-2147452885, 19, 0x00000000},
		{783, 20, 0x0000030F},
		{13488, 21, 0x000034B0},
		{-2147468270, 22, 0x00000000},
		{25659, 23, 0x0000643B},
		{22136, 24, 0x00005678},
		{-2147466614, 25, 0x00000000},
		{-2147470791, 26, 0x00000000},
		{13949, 27, 0x0000367D},
		{4926, 28, 0x0000133E},
		{-2147466400, 29, 0x00000000},
		{20875, 30, 0x0000518B},
		{-2147466504, 31, 0x00000000},
	}
	for _, v := range tests {
		r := USAT(v.op1, v.n, 0)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}

func Test_SSAT_ASR(t *testing.T) {
	tests := []struct {
		op1    int32
		n      int
		s      int
		result int32
	}{
		{-2147482807, 1, 15, -1},
		{2112, 2, 15, 0},
		{-2147458449, 3, 15, -4},
		{-2147468017, 4, 15, -8},
		{28321, 5, 15, 0},
		{21965, 6, 15, 0},
		{3249, 7, 15, 0},
		{10496, 8, 15, 0},
		{-2147466484, 9, 15, -256},
		{-2147481717, 10, 15, -512},
		{-2147477577, 11, 15, -1024},
		{-2147458796, 12, 15, -2048},
		{-2147462646, 13, 15, -4096},
		{-2147462634, 14, 15, -8192},
		{-2147476433, 15, 15, -16384},
		{-2147452987, 16, 15, -32768},
		{-2147467174, 17, 15, -65536},
		{9637, 18, 15, 0},
		{32198, 19, 15, 0},
		{-2147460888, 20, 15, -65536},
		{12659, 21, 15, 0},
		{1420, 22, 15, 0},
		{-2147463520, 23, 15, -65536},
		{-2147477199, 24, 15, -65536},
		{-2147458294, 25, 15, -65536},
		{-2147463237, 26, 15, -65536},
		{8931, 27, 15, 0},
		{-2147469908, 28, 15, -65536},
		{14481, 29, 15, 0},
		{-2147453890, 30, 15, -65536},
		{21547, 31, 15, 0},
		{-2147466429, 32, 15, -65536},
	}
	for _, v := range tests {
		r := SSAT(v.op1, v.n, -v.s)
		if r != v.result {
			fmt.Printf("%+v %d (expected) %d (actual)\n", v, v.result, r)
			t.Error("FAIL")
		}
	}
}
